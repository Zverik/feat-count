# Статистика по объектам в MWM

Этот набор скриптов считает статистику по фичам в заданной MWM,
а также разницу между двумя наборами MWM. Например, можно посчитать,
насколько выросла дорожная сеть во всей России между релизами.

Основной режим работы — сравнение целых каталогов. Чтобы сравнить
два релиза и получить файл CSV для загрузки в электронные таблицы,
запустите как-то так:

    ./calc_stat_all.sh config.txt /opt/mapsme/mwm/150613 /opt/mapsme/mwm/150624 10

Здесь первым параметром идёт имя файла со списком критериев. Он прост: через
точку с запятой идут регулярное выражения для типа по классификатору, тип
метрики (`cnt` для количества, `len` для длины), название критерия на русском языке.
Второй и третий параметры — предыдущий и новый релизы. Сравнение идёт по всем
файлам `*.mwm`, присутствующим в обоих каталогах. Последнее число — минимум
изменения значения в процентах, при котором оно выводится в итоговый файл.
По умолчанию выводятся все критерии, но для 300+ файлов это может быть многовато.

## calc_stat.sh

Сравнить два отдельных файла, или два набора файлов, можно этим скриптом.
Его же использует `calc_stat_all.sh`. Для сравнения двух файлов формат прост:

    ./calc_stat.sh config.txt old.mwm x new.mwm

Внимание на `x`, который разделяет старый и новый файл. Очевидно, что с таким
форматом файлов может быть много, и их нужно указывать через пробел. Все
значения для каждого набора файлов суммируются.

    ./calc_stat.sh config.txt old/Russia_*.mwm x 10 new/Russia_*.mwm

Число 10 — это та же нижняя граница изменения значений для фильтрации результатов.
Скрипт по умолчанию выводит список в человекочитаемом формате, чтобы
получить данные в формате CSV, нужно перед config.txt добавить ключ `--csv`.

Наконец, этот скрипт позволяет вывести информацию без сравнения, только для
одного или одной группы файлов MWM. Для этого просто не добавляйте `x` и вторую
группу файлов. Например:

    ./calc_stat.sh --csv config.txt Australia.mwm

## Как оно работает

Для получения количества объектов и длины линий по каждому типу используется
модифицированный `generator_tool`, из ветки zverik/stats. Туда добавлен подсчёт
длины, вырезаны ненужная статистика, сортировка и ограничение на 10 строк.

Из вывода генератора текст в понятном формате или CSV получается скриптом
`format_stat.py`. Он же сравнивает два файла между собой. Когда на входе
набор файлов, для суммирования значений используется `sum_stat.py`.

## Автор и лицензия

Скрипты написаны Ильёй Зверевым из MAPS.ME и опубликованы под лицензией MIT.
